<html>
	<head>
		<script src="http://cloud.github.com/downloads/processing-js/processing-js/processing-1.4.1.min.js"></script>
		<script type="text/processing"></script>
		<script type="text/processing" data-processing-target="mycanvas">

		//screen dimensions
		var width = 800;
		var height = 500;
		var dir = "down"; 
		var paused = true;
		Nick nick;
		enemies = new Array();
		//Enemy enemy;
		var lives = 3;
		
		var pointCounter = 0;
		
		var levels = [//1 = wall, 0 = space 2 = spots 20 rows / columns
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,2,2,1,1,1,1,1,1,2,2,2,1,1,2,1],
			[2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2],
			[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,1,1,1,2,1,1,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,2,2,2,2,2,2,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,1,1,1,1,1,1,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],
			[1,1,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,1,1],
			[2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,2,2,1,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]], 
			
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,2,2,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1],
			[1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,1,2,1,1,1],
			[1,2,2,2,1,2,1,1,1,1,2,1,1,1,2,1,2,2,2,1],
			[1,2,1,2,1,2,1,2,2,2,2,2,2,1,2,1,2,1,2,1],
			[1,2,1,2,1,2,1,1,1,1,1,1,1,1,2,1,2,1,2,1],
			[1,2,2,2,1,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],
			[1,1,1,2,1,2,2,2,2,1,1,2,2,2,2,1,2,1,1,1],
			[2,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]], 
			
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,2,1,1,2,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,2,2,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,2,1],
			[2,2,2,2,2,2,2,1,2,1,1,1,1,1,2,2,2,2,2,2],
			[1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,1,2,1,1,1],
			[1,2,2,2,1,2,1,1,1,1,2,1,1,1,2,1,2,2,2,1],
			[1,1,1,2,1,2,1,2,2,2,2,2,2,1,2,1,2,1,1,1],
			[1,2,1,2,1,2,1,1,1,1,1,1,1,1,2,1,2,1,1,1],
			[1,2,2,2,1,2,2,2,2,1,2,2,2,2,2,1,2,2,2,1],
			[1,1,1,2,1,2,1,2,2,1,2,2,2,2,1,1,2,1,1,1],
			[2,2,2,2,2,2,1,1,1,1,2,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,2,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,1,1,2,2,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]
			
			];
		
		//first level is initialized to first	
		var maze;
		
		//cell width and cell height
		var cellWidth = 20;
		var cellHeight = 20; 

			void setup()
			{
			
			  size(width,height);
			  background(125);
			  fill(255);
			  //noLoop();
			  PFont fontA = loadFont("courier");
			  textFont(fontA, 14); 
			  nick = new Nick(10, 10, 100, 25, 3); 
			  enemies.push(new Enemy(10, 10, 30, 25, 3));
			  enemies.push(new Enemy(10, 10, 30, 125, 3));
			  enemies.push(new Enemy(10, 10, 320, 85, 3));
			  maze = levels[0];

			  
			}

			void draw(){  
				background(125);
			  text("Hello Web!",20,20);
			  println("Hello ErrorLog!");
			 
			  //build the maze
			  for(int i =0; i< maze.length; i++){
			  	for(int j = 0; j<maze[0].length; j++){
					//draw every cell
					var x = cellWidth * j;
					var y = cellHeight *i;
					if(maze[i][j] == 0 || maze[i][j] == 2){
						//is space
						noStroke();
						fill(255, 0,0);
						rect(x, y, cellWidth, cellHeight); 
						if(maze[i][j] == 2){
							fill(255,255,255);
							ellipse(x+10,y+10, 10, 10);
						
						}
						
					}else if(maze[i][j] == 1 || maze[i][j] ==3){
						//is wall
						noStroke();
						fill(0,0,255);
						rect(x, y, cellWidth, cellHeight); 
						if(maze[i][j] == 3){
							fill(255,0,0);
                			ellipse(x+10,y+10, 10, 10);
						}
					}
					
			  		
			  	}
			  }
			  
			  nick.drawNick();
			  for(int i = 0; i<enemies.length; i++){
			  	enemies[i].drawEnemy();
			  	if(!paused)
			  		enemies[i].moveEnemy();
			  		
			  	if(Math.abs((nick.x- enemies[i].x)) < 10 && Math.abs((nick.y - enemies[i].y)) <10){
			  		nick.die();
			  	
			  	}
			  }
			  
			  
			  //detect key,and decide direction
			  if(keyPressed==true){
			  	if(keyCode ==39){
			  		dir = "right";
			  	}else if (keyCode == 37){
			  		dir = "left";
			  	}else if(keyCode == 38){
			  		dir = "up";
			  	}else if(keyCode == 40){
			  		dir = "down";
			  	}
			  	
			  }
			  
			  //only move if not touching wall
			  
			  if(!paused && nick.canMove(dir)){
			  	nick.moveNick(dir);
			  }
			  if(pointCounter==193){
			  	maze = levels[1];
			  }
			  
			  
				if(lives == 0){
					lives = 3;
					maze = levels[0];
					maze[0][19] = 3;
					maze[0][18] = 3;
					for(int i = 0; i<maze.length; i++){
						for(int j = 0; j<maze.length; j++){
							if(maze[i][j] ==0){
								maze[i][j]=2;
							}
						}
					}
					paused = true;
				}
			  
			  

			  

		}
		
		
		class Nick{
			var nWidth;
			var nHeight; 
			var x;
			var y;
			var s;
			
			Nick(w,h,xVal, yVal, speed){
				nWidth = w;
				nHeight = h;
				x = xVal;
				y=yVal;
				s = speed;
			}
			void drawNick(){
				noStroke();
				fill(0,255,0);
			  	rect(x,y,nWidth,nHeight);
			}
			//called before moveNick 
			
			boolean canMove(dir){
				var canMove = false;
			
				var col = Math.floor(x / cellWidth); //cellWidth;
			  	var row = Math.floor(y / cellHeight); //cellHeight; 
			  	if(dir =="down" && row+1 < 20){
			  		if(maze[row+1][col] == 0 || maze[row+1][col] == 2){
			  			canMove = true;
			  			if(maze[row+1][col] == 2){
			  				pointCounter++;
			  				maze[row+1][col] = 0;
			  			}
			  		}
			  			
			  	}
			  	if(dir == "up" && row-1 >=0){

			  		if(maze[row-1][col] == 0 || maze[row-1][col] == 2){
			  			canMove = true;
			  			if(maze[row-1][col] == 2){
			  				pointCounter++;
			  				maze[row-1][col] =0;
			  			}
			  		}
			  	}
			  	if(dir == "left" && col -1 >=0 ){
			  		if(maze[row][col-1] == 0 || maze[row][col-1] == 2){
			  			canMove = true;
			  			if(maze[row][col-1] == 2){
			  				pointCounter++;
			  				maze[row][col-1] =0;
			  			}
			  		}
			  	}
			  	if(dir == "right" && col+1 <20){
			  		if(maze[row][col+1] == 0 || maze[row][col+1] == 2){
			  			canMove = true;
			  			if(maze[row][col+1] == 2){
			  				pointCounter++;
			  				maze[row][col+1] = 0;
			  			}
			  		}
			  	}
			  	
				return canMove;
		
				
			}
			
			void moveNick(dir){
			
				
				
				//portals
				if(x > maze[0].length * (cellWidth-1)-5 ){
					x=30;//-= (maze[0].length * (cellWidth-1)-5);
				}else if(x < 30){
					x=maze[0].length * (cellWidth-1)-5;
				}else if(y > maze.length * cellHeight){
					y -= maze.length *cellHeight;
				}else if(y<0){
					y += maze.length* cellHeight;
				}
				
				//don't move until you know the next space is empty
				if (dir == "up"){
					y = y-s;
				}else if (dir == "down"){
					y = y +s;
				}else if (dir == "left"){
					x = x -s; 
				}else if(dir == "right"){
					x = x+s;
				}
			}
			void die(){
				lives--;
				x=60;
				y = 30;
				dir="right";
				if (lives == 2){
					maze[0][19]=1;
				}else{
					maze[0][18]=1;
				
				}
			}
		
		
		}
		class Enemy{
		
			var nWidth;
			var nHeight; 
			var x;
			var y;
			var s;
			var dir;
			
			Enemy(w,h,xVal, yVal, speed){
				nWidth = w;
				nHeight = h;
				x = xVal;
				y=yVal;
				s = speed;
				dir = "down";
			}
			void drawEnemy(){
				noStroke();
				fill(0,0,255);
			  	rect(x,y,nWidth,nHeight);
			}
			void moveEnemy(){
				
				//portals
				if(x > maze[0].length * (cellWidth-1)-5 ){
					x=30;//-= (maze[0].length * (cellWidth-1)-5);
				}else if(x < 30){
					x=maze[0].length * (cellWidth-1)-5;
				}else if(y > maze.length * cellHeight){
					y -= maze.length *cellHeight;
				}else if(y<0){
					y += maze.length* cellHeight;
				}
				if(canMove()){
				//don't move until you know the next space is empty
				if (dir == "up"){
					y = y-s;
				}else if (dir == "down"){
					y = y +s;
				}else if (dir == "left"){
					x = x -s; 
				}else if(dir == "right"){
					x = x+s;
				}
				}else{
					var rand = Math.floor(Math.random() * 4) + 1;
					if (rand == 1){
						dir = "right";
					}else if (rand == 2){
						dir = "left";
					}else if (rand == 3){
						dir = "up";
					}else{
						dir = "down";
					}
				}
			}
			
			boolean canMove(){
			
				var canMove = false;
			
				var col = Math.floor(x / 20); //cellWidth;
			  	var row = Math.floor(y / 20); //cellHeight; 
			  	if(dir =="down" && row+1 < 20){
			  		if(maze[row+1][col] == 0 || maze[row+1][col] == 2){
			  			canMove = true;
			  		}
			  			
			  	}
			  	if(dir == "up" && row-1 >=0){
			  		if(maze[row-1][col] == 0 || maze[row-1][col] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	if(dir == "left" && col -1 >=0 ){
			  		if(maze[row][col-1] == 0 || maze[row][col-1] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	if(dir == "right" && col+1 <20){
			  		if(maze[row][col+1] == 0 || maze[row][col+1] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	
				return canMove;
			}
			
		
		
		}
		mouseClicked = function(){
			paused = !paused; 
		}
		
		/*fiona
		var w = 10;
var h = 10;
var x = 100;
var y = 100;
fill(0,0,0);
rect(x-5,y-5,4*w,2*h);
fill(175, 230, 92);
rect(x,y,3*w,2*h);
fill(255,255,255);
rect(x+3,y,w,h-2);
rect(x+17,y,w,h-2);
fill(0, 0, 0);
rect(x+7,y,w/2,h/2);
rect(x+21,y,w/2,h/2);
fill(255, 0, 0);
rect(x+15,y+10,w*0.8,h*0.8);

nick
var w = 10;
var h = 10;
var x = 100;
var y = 100;
fill(0,0,0);
rect(x,y-5,3*w,2*h);
fill(255,255,0);
rect(x,y,3*w,2*h);
fill(255, 255, 255);
rect(x+3,y,w,h-2);
rect(x+17,y,w,h-2);
fill(0, 0, 0);
rect(x+3,y,w/2,h/2);
rect(x+17,y,w/2,h/2);
fill(255, 0, 0);
rect(x+15,y+10,w*0.8,h*0.8);*/
		
		

		
		</script>
	</head>
	<body>
		<canvas id="mycanvas"></canvas>
	</body>
</html>