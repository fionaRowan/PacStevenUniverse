<html>
	<head>
		<script src="http://cloud.github.com/downloads/processing-js/processing-js/processing-1.4.1.min.js"></script>
		<script type="text/processing"></script>
		<script type="text/processing" data-processing-target="mycanvas">

		//screen dimensions
		var width = 400;
		var height = 400;
		var dir = "down"; 
		var paused = true;
		var start = true;
		Nick nick;
		enemies = new Array();
		var lives = 3;
		//initialized to number of 2's in first level
		var numberOfPoints=197;
		var level = 0;
		
		var pointCounter = 0;
		
		var levels = [//1 = wall, 0 = space 2 = spots 20 rows / columns
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,2,2,1,1,1,1,1,1,2,2,2,1,1,2,1],
			[2,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2],
			[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,1,1,1,2,1,1,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,2,2,2,2,2,2,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,1,1,1,1,1,1,1,1,2,2,1,1,1,1],
			[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],
			[1,1,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,1,1],
			[2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,2,2,1,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]], 
			
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,2,2,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1],
			[1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,1,2,1,1,1],
			[1,2,2,2,1,2,1,1,1,1,2,1,1,1,2,1,2,2,2,1],
			[1,2,1,2,1,2,1,2,2,2,2,2,2,1,2,1,2,1,2,1],
			[1,2,1,2,1,2,1,1,1,1,1,1,1,1,2,1,2,1,2,1],
			[1,2,2,2,1,2,2,2,2,2,2,2,2,2,2,1,2,2,2,1],
			[1,1,1,2,1,2,2,2,2,1,1,2,2,2,2,1,2,1,1,1],
			[2,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]], 
			
			[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3],
			[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
			[1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,2,1,1,2,1,2,1,2,1,1,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,2,2,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,2,1],
			[2,2,2,2,2,2,2,1,2,1,1,1,1,1,2,2,2,2,2,2],
			[1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,1,2,1,1,1],
			[1,2,2,2,1,2,1,1,1,1,2,1,1,1,2,1,2,2,2,1],
			[1,1,1,2,1,2,1,2,2,2,2,2,2,1,2,1,2,1,1,1],
			[1,2,1,2,1,2,1,1,1,1,1,1,1,1,2,1,2,1,1,1],
			[1,2,2,2,1,2,2,2,2,1,2,2,2,2,2,1,2,2,2,1],
			[1,1,1,2,1,2,1,2,2,1,2,2,2,2,1,1,2,1,1,1],
			[2,2,2,2,2,2,1,1,1,1,2,1,1,2,2,2,2,2,2,2],
			[1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,2,1],
			[1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,2,2,1],
			[1,2,2,2,2,1,2,2,2,2,2,2,2,2,1,2,1,1,2,1],
			[1,2,1,1,2,1,2,1,1,1,1,1,1,1,1,2,2,1,2,1],
			[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,1],
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]
			
			];
		
		//current level
		var maze;
		
		//cell width and cell height
		var cellWidth = 20;
		var cellHeight = 20; 

			void setup()
			{
				background(244,29,155);
			  size(width,height);
			  fill(255);
			  PFont fontA = loadFont("courier");
			  textFont(fontA, 14); 
			  nick = new Nick(5, 5, 100, 25, 3); 
			  enemies.push(new Enemy(5, 5, 30, 25, 3));
			  enemies.push(new Enemy(5, 5, 30, 125, 3));
			  enemies.push(new Enemy(5, 5, 320, 85, 3));
			  maze = levels[level];
			  nick.drawNick();
			  /*for(int i = 0; i<enemies.length; i++){
			  	enemies[i].drawEnemy();
			  }*/
			  noLoop();

			  
			}

			void draw(){  
			
				//when collected all points, change levels
			  if(pointCounter==numberOfPoints){
			  	if(level+1 < levels.length){
			  		maze = levels[++level];
				  	pointCounter = 0;
				  	if(level ==1){
				  		numberOfPoints = 201;
				  	}else{
			  			//number of points in level 2
				  		numberOfPoints = 197;
			  	
			  	
			  		}
			  	}
			  }
			  
			 
			  //build the maze
			  background(125);
			  buildMaze();
			  
			  activateEnemies();
			  if(start==true){
			  	love();
			  	start = false;
			  	}
			  	nick.drawNick();
			  
			  //detect key,and decide direction
			  if(keyPressed==true){
			  	if(keyCode ==39){
			  		dir = "right";
			  	}else if (keyCode == 37){
			  		dir = "left";
			  	}else if(keyCode == 38){
			  		dir = "up";
			  	}else if(keyCode == 40){
			  		dir = "down";
			  	}
			  	
			  }
			  if(nick.canMove(dir)){
			  	nick.moveNick(dir);
			  }
			  if(lives == 0){
					maze = levels[0];
					maze[0][19] = 3;
					maze[0][18] = 3;
					pointCounter = 0;
					numberOfPoints=197;
					for(int i = 0; i<maze.length; i++){
						for(int j = 0; j<maze.length; j++){
							if(maze[i][j] ==0){
								maze[i][j]=2;
							}
						}
					}
					
					for(int j =0; j<enemies.length; j++){
						enemies[j].x = enemies[j].startX;
						enemies[j].y = enemies[j].startY;
					}
					buildMaze();
					activateEnemies();
					love();
					nick.drawNick();
					paused = true;
					noLoop();
					lives = 3;
				}
			  
			  
			  
				

		}
		
		function love(){
			background(244,29,155);
			noStroke();
			fill(255,255,255);
			//I
			rect(10,40,10,100);
			//L
			rect(50,40,10,100);
			rect(50,130,45,10);

			//O
			rect(100,40,10,100);
			rect(135,40,10,100);
			rect(100,130,40,10);
			rect(100,40,40,10);

			//V
			rect(160,40,10,100);
			rect(185,40,10,100);
			rect(160,130,30,10);

			//E
			rect(210,40,10,100);
			rect(210,130,40,10);
			rect(210,40,40,10);
			rect(210,85,30,10);

			//Y
			rect(65,240,10,100);
			rect(30,330,40,10);
			rect(30,290,40,10);
			rect(30,240,10,60);

			//O
			rect(100,240,10,100);
			rect(135,240,10,100);
			rect(100,330,40,10);
			rect(100,240,40,10);

			//U
			rect(160,240,10,100);
			rect(195,240,10,100);
			rect(160,330,40,10);

			//!
			rect(230,240,10,80);
			rect(230,330,10,10);


		}
		
		function activateEnemies(){
			for(int i = 0; i<enemies.length; i++){
			  	enemies[i].drawEnemy();
			  	enemies[i].moveEnemy();
			  	if(Math.abs((nick.x- enemies[i].x)) < 10 && Math.abs((nick.y - enemies[i].y)) <10){
			  		nick.die();
			  	
			  	}
			  }
		}
		
		function buildMaze(){
		for(int i =0; i< maze.length; i++){
			  	for(int j = 0; j<maze[0].length; j++){
					//draw every cell
					var x = cellWidth * j;
					var y = cellHeight *i;
					if(maze[i][j] == 0 || maze[i][j] == 2){
						//is space
						noStroke();
						fill(216,103,237);
						rect(x, y, cellWidth, cellHeight); 
						if(maze[i][j] == 2){
						var w = 10;
						var h = 10;
							fill(61, 29, 29);
							ellipse(x+10,y+9,w*1.2,h); //y+9 x+10
							triangle(x+9,y+4,x+4,y+2,x+4,y+9);
							triangle(x+11,y+4,x+16,y+2,x+16,y+9);
							fill(255,255,255);
							ellipse(x+7,y+8,w/5,h/3);
							ellipse(x+13,y+8, w/5,h/3);
							//ellipse(x+10,y+11,w/2,h/4);
							//fill(255,255,255);
							//ellipse(x+10,y+10, 10, 10);
						
						}
						
					}else if(maze[i][j] == 1 || maze[i][j] ==3){
						//is wall
						noStroke();
						fill(188,252,255);
						
						rect(x, y, cellWidth, cellHeight); 
						if(maze[i][j] == 3){
							fill(244,29,155);
                			ellipse(x+10,y+10, 10, 10);
						}
					}
					
			  		
			  	}
			  }
		
		}
		
		
		class Nick{
			var w;
			var h; 
			var x;
			var y;
			var startX;
			var startY;
			var s;
			
			Nick(nWidth,nHeight,xVal, yVal, speed){
				w=nWidth;
				h=nHeight;
				x = xVal;
				y=yVal;
				startX = x;
				startY=y;
				s = speed;
			}
			void drawNick(){
				noStroke();
				fill(0,0,0);
				ellipse(x,y-4,1.5*w, h);
				ellipse(x-2,y,1.5*w, h);
				ellipse(x+6.5,y-6,1.5*w, h);
				ellipse(x+12,y-5,1.5*w, h);
				rect(x,y-4,3*w,2*h);
				fill(245, 196, 214);
				rect(x,y,3*w,2*h);
				fill(255, 255, 255);
				rect(x+2,y,w,h-1);
				rect(x+9,y,w,h-1);
				fill(0, 0, 0);
				rect(x+3,y,w/2.5,h/2);
				rect(x+10,y,w/2.5,h/2);
				fill(255, 0, 0);
				noStroke();
				rect(x+5,y+5,w*1.5,h*0.3);
				rect(x+7,y+5,w*0.8,h*0.69);
			}
			//called before moveNick 
			
			boolean canMove(dir){
				var canMove = false;
			
				var col = Math.floor(x / cellWidth); 
			  	var row = Math.floor(y / cellHeight);
			  	if(dir =="down" && row+1 < 20){
			  		if(maze[row+1][col] == 0 || maze[row+1][col] == 2){
			  			canMove = true;
			  			if(maze[row+1][col] == 2){
			  				pointCounter++;
			  				maze[row+1][col] = 0;
			  			}
			  		}
			  			
			  	}
			  	if(dir == "up" && row-1 >=0){

			  		if(maze[row-1][col] == 0 || maze[row-1][col] == 2){
			  			canMove = true;
			  			if(maze[row-1][col] == 2){
			  				pointCounter++;
			  				maze[row-1][col] =0;
			  			}
			  		}
			  	}
			  	if(dir == "left" && col -1 >=0 ){
			  		if(maze[row][col-1] == 0 || maze[row][col-1] == 2){
			  			canMove = true;
			  			if(maze[row][col-1] == 2){
			  				pointCounter++;
			  				maze[row][col-1] =0;
			  			}
			  		}
			  	}
			  	if(dir == "right" && col+1 <20){
			  		if(maze[row][col+1] == 0 || maze[row][col+1] == 2){
			  			canMove = true;
			  			if(maze[row][col+1] == 2){
			  				pointCounter++;
			  				maze[row][col+1] = 0;
			  			}
			  		}
			  	}
			  	
				return canMove;
		
				
			}
			
			void moveNick(dir){
			
				
				
				//portals
				if(x > maze[0].length * (cellWidth-1)-5 ){
					x=30;//-= (maze[0].length * (cellWidth-1)-5);
				}else if(x < 30){
					x=maze[0].length * (cellWidth-1)-5;
				}else if(y > maze.length * cellHeight){
					y -= maze.length *cellHeight;
				}else if(y<0){
					y += maze.length* cellHeight;
				}
				
				//don't move until you know the next space is empty
				if (dir == "up"){
					y = y-s;
				}else if (dir == "down"){
					y = y +s;
				}else if (dir == "left"){
					x = x -s; 
				}else if(dir == "right"){
					x = x+s;
				}
			}
			void die(){
				lives--;
				x=startX;
				y = startY;
				dir="right";
				if (lives == 2){
					maze[0][19]=1;
				}else{
					maze[0][18]=1;
				
				}
			}
		
		
		}
		class Enemy{
		
			var w;
			var h;
			var startX;
			var startY;
			var x;
			var y;
			var s;
			var dir;
			
			Enemy(width,height,xVal, yVal, speed){
				w=width;
				h = height;
				x = xVal;
				startX = xVal;
				y=yVal;
				startY=yVal;
				s = speed;
				dir = "down";
			}
			void drawEnemy(){
			
				fill(0,0,0);
				rect(x-3,y-3,4*w,2.5*h);
				fill(255, 5, 188);
				rect(x,y,3*w,2*h);
				fill(250, 215, 250);
				rect(x+3,y,w*2.3,h-2);
				line(x+15, y+15, x+15+w*0.8, y+15);
				fill(255, 0, 0);
			/*
				noStroke();
				fill(0,0,255);
			  	rect(x,y,nWidth,nHeight);*/
			}
			void moveEnemy(){
				
				//portals
				if(x > maze[0].length * (cellWidth-1)-5 ){
					x=30;//-= (maze[0].length * (cellWidth-1)-5);
				}else if(x < 30){
					x=maze[0].length * (cellWidth-1)-5;
				}else if(y > maze.length * cellHeight){
					y -= maze.length *cellHeight;
				}else if(y<0){
					y += maze.length* cellHeight;
				}
				if(canMove()){
				//don't move until you know the next space is empty
				if (dir == "up"){
					y = y-s;
				}else if (dir == "down"){
					y = y +s;
				}else if (dir == "left"){
					x = x -s; 
				}else if(dir == "right"){
					x = x+s;
				}
				}else{
					var rand = Math.floor(Math.random() * 4) + 1;
					if (rand == 1){
						dir = "right";
					}else if (rand == 2){
						dir = "left";
					}else if (rand == 3){
						dir = "up";
					}else{
						dir = "down";
					}
				}
			}
			
			boolean canMove(){
			
				var canMove = false;
			
				var col = Math.floor(x / 20); //cellWidth;
			  	var row = Math.floor(y / 20); //cellHeight; 
			  	if(dir =="down" && row+1 < 20){
			  		if(maze[row+1][col] == 0 || maze[row+1][col] == 2){
			  			canMove = true;
			  		}
			  			
			  	}
			  	if(dir == "up" && row-1 >=0){
			  		if(maze[row-1][col] == 0 || maze[row-1][col] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	if(dir == "left" && col -1 >=0 ){
			  		if(maze[row][col-1] == 0 || maze[row][col-1] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	if(dir == "right" && col+1 <20){
			  		if(maze[row][col+1] == 0 || maze[row][col+1] == 2){
			  			canMove = true;
			  			
			  		}
			  	}
			  	
				return canMove;
			}
			
		
		
		}
		mouseClicked = function(){
			paused = !paused; 
			if(paused){
				noLoop();
			}else{
				loop();
			}
		}
		
		

		
		</script>
	</head>
	<body>
		<canvas id="mycanvas"></canvas>
	</body>
</html>